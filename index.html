<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Inventario de Ropa</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #e6f0fa;
      font-size: 18px;
      line-height: 1.5;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-size: 28px;
      margin-bottom: 20px;
    }
    .container {
      max-width: 100%;
      margin: 0 auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .form-group { margin-bottom: 20px; }
    label {
      display: block;
      margin-bottom: 8px;
      color: #34495e;
      font-weight: 600;
      font-size: 20px;
    }
    input, select {
      width: 100%;
      padding: 12px;
      font-size: 18px;
      border: 2px solid #bdc3c7;
      border-radius: 8px;
      box-sizing: border-box;
      background-color: #f9fbfc;
      transition: border-color 0.3s;
    }
    input:focus, select:focus { border-color: #3498db; outline: none; }
    .option-btn {
      display: inline-block;
      width: 100px;
      height: 100px;
      margin: 5px;
      border: 2px solid transparent;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      line-height: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      padding: 5px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .option-btn.selected { border-color: #34495e; box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
    .option-btn.blue { background-color: #3498db; color: white; }
    .option-btn.red { background-color: #e74c3c; color: white; }
    .option-btn.yellow { background-color: #f1c40f; color: #333; }
    .option-btn.green { background-color: #2ecc71; color: white; }
    button {
      width: 100%;
      padding: 14px;
      font-size: 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 10px;
    }
    button:hover { background-color: #2980b9; }
    button.export { background-color: #2ecc71; }
    button.export:hover { background-color: #27ae60; }
    button.import { background-color: #f39c12; }
    button.import:hover { background-color: #e67e22; }
    button.delete-all { background-color: #e74c3c; }
    button.delete-all:hover { background-color: #c0392b; }
    #csv-upload { margin-top: 10px; display: none; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 16px;
    }
    th, td { border: 1px solid #dfe6e9; padding: 12px; text-align: left; }
    th { background-color: #3498db; color: white; font-size: 18px; }
    td { background-color: #f9fbfc; }
    tr { cursor: move; }
    tr.dragging { opacity: 0.5; background-color: #e0e0e0; }
    .drag-icon { font-size: 20px; color: #34495e; cursor: move; text-align: center; width: 40px; }
    .drag-icon:hover { color: #3498db; }
    .icon-cell { font-size: 20px; text-align: center; }
    .actions button {
      width: auto; padding: 8px 16px; font-size: 16px; margin-right: 10px;
    }
    .actions button.delete { background-color: #e74c3c; }
    .actions button.delete:hover { background-color: #c0392b; }
    .option-group { display: flex; flex-wrap: wrap; justify-content: flex-start; }
    @media (max-width: 600px) {
      body { padding: 10px; font-size: 16px; }
      h1 { font-size: 24px; }
      label { font-size: 18px; }
      input, select { font-size: 16px; padding: 10px; height: 50px; }
      .option-btn { font-size: 14px; width: 80px; height: 80px; line-height: 18px; }
      button { font-size: 18px; padding: 12px; }
      th, td { font-size: 14px; padding: 10px; }
      .actions button { font-size: 14px; padding: 6px 12px; }
      .drag-icon, .icon-cell { font-size: 16px; width: 30px; }
      .option-group { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sistema de Inventario de Ropa</h1>
    <div class="form-group">
      <label for="nombre">Nombre del Producto</label>
      <input type="text" id="nombre" list="nombresRecomendados" placeholder="Ej: CALZA">
      <datalist id="nombresRecomendados">
        <option value="CALZA">
        <option value="BABUCHA">
        <option value="PANTALON">
        <option value="PALAZO">
        <option value="TOP">
        <option value="CAMPERA">
        <option value="BUZO">
        <option value="REMERA">
        <option value="CAMISETA">
      </datalist>
      <label for="cantidad">Cantidad</label>
      <input type="number" id="cantidad" min="0" placeholder="Ej: 10">
      <label for="color">Color</label>
      <input type="text" id="color" list="coloresRecomendados" placeholder="Ej: negro">
      <datalist id="coloresRecomendados">
        <option value="negro">
        <option value="azul marino">
        <option value="francia">
        <option value="bordo">
        <option value="melange">
        <option value="topo">
      </datalist>
      <label for="talle">Talle</label>
      <input type="text" id="talle" list="talles" placeholder="Ej: 3 o S">
      <datalist id="talles">
        <option value="1"><option value="2"><option value="3">
        <option value="4"><option value="5"><option value="6">
        <option value="7"><option value="8">
      </datalist>
      <label for="tela">Tela</label>
      <select id="tela">
        <option value="LYCRA">LYCRA</option>
        <option value="SAPLEX JASPEADO">SAPLEX JASPEADO</option>
        <option value="ALGODON CON LYCRA">ALGODON CON LYCRA</option>
        <option value="RUSTICO">RUSTICO</option>
        <option value="MODAL">MODAL</option>
        <option value="MORLEY">MORLEY</option>
        <option value="JEAN">JEAN</option>
        <option value="CORDERITO">CORDERITO</option>
      </select>
      <label>Temporada</label>
      <div class="option-group">
        <button class="option-btn blue" onclick="seleccionarTemporada('Verano')">‚òÄ<br>Verano</button>
        <button class="option-btn red" onclick="seleccionarTemporada('Invierno')">‚ùÑ<br>Invierno</button>
        <button class="option-btn yellow" onclick="seleccionarTemporada('Todo el a√±o')">üìÖ<br>Todo el a√±o</button>
      </div>
      <label>Tipo</label>
      <div class="option-group">
        <button class="option-btn green" onclick="seleccionarTipo('Hombre')">üë®<br>Hombre</button>
        <button class="option-btn blue" onclick="seleccionarTipo('Mujer')">üë©<br>Mujer</button>
        <button class="option-btn red" onclick="seleccionarTipo('Ni√±o')">üßí<br>Ni√±o</button>
      </div>
      <button onclick="agregarOEditarProducto()">Agregar o Editar Producto</button>
      <button class="import" onclick="document.getElementById('csv-upload').click()">Importar CSV</button>
      <input type="file" id="csv-upload" accept=".csv" onchange="importarCSV(this.files[0])">
      <button class="export" onclick="exportarPDFyCSV()">Exportar a PDF y CSV</button>
      <button class="delete-all" onclick="borrarTodoInventario()">Borrar Todo</button>
    </div>

    <div class="form-group">
      <label for="filtroArticulo">Filtrar por Art√≠culo</label>
      <select id="filtroArticulo" onchange="filtrarTabla()">
        <option value="">Todos</option>
      </select>
    </div>
    <table id="tablaInventario">
      <thead>
        <tr>
          <th style="width:40px;">Mover</th>
          <th>Nombre</th><th>Cantidad</th><th>Color</th><th>Talle</th>
          <th>Tela</th><th>Temporada</th><th>Tipo</th><th>Acciones</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla"></tbody>
    </table>
  </div>

  <script>
    let inventario = JSON.parse(localStorage.getItem('inventario')) || [];
    let editIndex = -1, temporadaSeleccionada = '', tipoSeleccionado = '', draggedRow = null;

    function generarId(){ return '_' + Math.random().toString(36).substr(2, 9); }
    function seleccionarTemporada(t){ temporadaSeleccionada=t;document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));event.target.classList.add('selected'); }
    function seleccionarTipo(t){ tipoSeleccionado=t;document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));event.target.classList.add('selected'); }

    function agregarOEditarProducto(){
      const nombre=document.getElementById('nombre').value.trim();
      const cantidad=document.getElementById('cantidad').value;
      const color=document.getElementById('color').value.trim();
      const talle=document.getElementById('talle').value.trim();
      const tela=document.getElementById('tela').value;
      const temporada=temporadaSeleccionada, tipo=tipoSeleccionado;

      let errores=[];
      if(!nombre) errores.push("El nombre es obligatorio.");
      if(!cantidad||isNaN(cantidad)||parseInt(cantidad)<0) errores.push("Cantidad inv√°lida.");
      if(!color) errores.push("El color es obligatorio.");
      if(!talle||(parseFloat(talle)<=0&&!isNaN(parseFloat(talle)))) errores.push("Talle inv√°lido.");
      if(!temporada) errores.push("Seleccion√° temporada.");
      if(!tipo) errores.push("Seleccion√° tipo.");

      if(errores.length>0){ alert("Errores:\n- "+errores.join("\n- "));return; }

      const producto={ id: editIndex===-1?generarId():inventario[editIndex].id, nombre, cantidad:parseInt(cantidad), color, talle, tela, temporada, tipo };

      if(editIndex===-1){ inventario.push(producto);} else { inventario[editIndex]=producto; editIndex=-1; }

      localStorage.setItem('inventario',JSON.stringify(inventario));
      actualizarTabla(); limpiarFormulario();
    }

    function editarProducto(id){
      editIndex=inventario.findIndex(p=>p.id===id); const p=inventario[editIndex];
      document.getElementById('nombre').value=p.nombre;
      document.getElementById('cantidad').value=p.cantidad;
      document.getElementById('color').value=p.color;
      document.getElementById('talle').value=p.talle;
      document.getElementById('tela').value=p.tela;
      temporadaSeleccionada=p.temporada; tipoSeleccionado=p.tipo;
      document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('selected'));
      document.querySelector(`.option-btn[onclick="seleccionarTemporada('${temporadaSeleccionada}')"]`)?.classList.add('selected');
      document.querySelector(`.option-btn[onclick="seleccionarTipo('${tipoSeleccionado}')"]`)?.classList.add('selected');
      document.getElementById('nombre').focus();
    }

    function eliminarProducto(id){
      if(confirm('¬øEliminar este producto?')){
        inventario = inventario.filter(p=>p.id!==id);
        localStorage.setItem('inventario', JSON.stringify(inventario));
        actualizarTabla();
      }
    }

    // NUEVO: Borrar todo el inventario con confirmaci√≥n
    function borrarTodoInventario(){
      if(inventario.length===0){ alert("El inventario ya est√° vac√≠o."); return; }
      if(confirm("‚ö†Ô∏è Atenci√≥n: vas a borrar TODO el inventario.\n\n¬øContinuar?")){
        inventario = [];
        localStorage.setItem('inventario', JSON.stringify(inventario));
        actualizarTabla();
        alert("Inventario borrado.");
      }
    }

    function actualizarTabla(){
      const cuerpo=document.getElementById('cuerpoTabla');
      cuerpo.innerHTML='';
      inventario.forEach(p=>{
        const temporadaIcono=p.temporada==='Verano'?'‚òÄ':p.temporada==='Invierno'?'‚ùÑ':'üìÖ';
        const tipoIcono=p.tipo==='Hombre'?'üë®':p.tipo==='Mujer'?'üë©':'üßí';
        const fila=document.createElement('tr');
        fila.setAttribute('draggable','true');
        fila.setAttribute('data-id',p.id);
        fila.innerHTML=`
          <td class="drag-icon">‚ò∞</td>
          <td>${p.nombre}</td>
          <td>${p.cantidad}</td>
          <td>${p.color}</td>
          <td>${p.talle}</td>
          <td>${p.tela}</td>
          <td class="icon-cell">${temporadaIcono} ${p.temporada}</td>
          <td class="icon-cell">${tipoIcono} ${p.tipo}</td>
          <td class="actions">
            <button onclick="editarProducto('${p.id}')">Editar</button>
            <button class="delete" onclick="eliminarProducto('${p.id}')">Eliminar</button>
          </td>`;
        fila.addEventListener('dragstart',handleDragStart);
        fila.addEventListener('dragover',handleDragOver);
        fila.addEventListener('drop',handleDrop);
        fila.addEventListener('dragend',handleDragEnd);
        fila.addEventListener('dblclick',(e)=>{ if(!e.target.closest('.drag-icon') && !e.target.closest('.actions')) editarProducto(p.id); });
        cuerpo.appendChild(fila);
      });
      actualizarFiltroArticulos();
      filtrarTabla();
    }

    function actualizarFiltroArticulos(){
      const filtro=document.getElementById('filtroArticulo');
      const articulos=[...new Set(inventario.map(p=>{
        const primera=p.nombre.split(' ')[0].toLowerCase();
        return primera.charAt(0).toUpperCase()+primera.slice(1);
      }))];
      filtro.innerHTML='<option value=\"\">Todos</option>';
      articulos.sort().forEach(a=>{
        const op=document.createElement('option');
        op.value=a.toLowerCase();
        op.textContent=a;
        filtro.appendChild(op);
      });
    }

    function filtrarTabla(){
      const filtro=document.getElementById('filtroArticulo').value.toLowerCase();
      document.querySelectorAll('#cuerpoTabla tr').forEach(row=>{
        const nombreCell=row.querySelector('td:nth-child(2)');
        if(nombreCell){
          const primera=nombreCell.textContent.split(' ')[0].toLowerCase();
          row.style.display = (!filtro || primera===filtro) ? '' : 'none';
        }
      });
    }

    function handleDragStart(e){
      draggedRow=e.target;
      e.target.classList.add('dragging');
      e.dataTransfer.effectAllowed='move';
      e.dataTransfer.setData('text/plain', e.target.getAttribute('data-id'));
    }
    function handleDragOver(e){ e.preventDefault(); e.dataTransfer.dropEffect='move'; }
    function handleDrop(e){
      e.preventDefault();
      const droppedId=e.dataTransfer.getData('text/plain');
      const targetRow=e.target.closest('tr');
      if(!targetRow) return;
      const targetId=targetRow.getAttribute('data-id');
      if(droppedId!==targetId){
        const di=inventario.findIndex(p=>p.id===droppedId);
        const ti=inventario.findIndex(p=>p.id===targetId);
        const [dragged]=inventario.splice(di,1);
        inventario.splice(ti,0,dragged);
        localStorage.setItem('inventario', JSON.stringify(inventario));
        actualizarTabla();
      }
    }
    function handleDragEnd(e){ e.target.classList.remove('dragging'); draggedRow=null; }

    function importarCSV(file){
      if(!file){ alert('No se seleccion√≥ ning√∫n archivo.'); return; }
      const reader=new FileReader();
      reader.onload=function(e){
        const text=e.target.result;
        const lines=text.split('\n').filter(line=>line.trim()!=='');
        let importedCount=0;
        lines.forEach((line,index)=>{
          if(index===0) return; // encabezado
          const separators=[',','|'];
          let parts=null;
          for(const sep of separators){
            parts=line.split(sep).map(p=>p.trim());
            if(parts.length>=7) break;
          }
          if(!parts || parts.length<7) return;

          const nombre=parts[0];
          const cantidad=parseInt(parts[1]);
          const color=parts[2];
          const talle=parts[3];
          const tela=parts[4];
          const temporada=parts[5];
          const tipo=parts[6];

          let errores=[];
          if(!nombre) errores.push(`Nombre vac√≠o en l√≠nea ${index+1}`);
          if(isNaN(cantidad) || cantidad<0) errores.push(`Cantidad no v√°lida en l√≠nea ${index+1}`);
          if(!color) errores.push(`Color vac√≠o en l√≠nea ${index+1}`);
          if(!talle || (parseFloat(talle)<=0 && !isNaN(parseFloat(talle)))) errores.push(`Talle no v√°lido en l√≠nea ${index+1}`);
          if(!tela) errores.push(`Tela vac√≠a en l√≠nea ${index+1}`);
          if(!temporada) errores.push(`Temporada vac√≠a en l√≠nea ${index+1}`);
          if(!tipo) errores.push(`Tipo vac√≠o en l√≠nea ${index+1}`);
          if(errores.length>0) return;

          const producto={ id: generarId(), nombre, cantidad, color, talle, tela, temporada, tipo };
          inventario.push(producto);
          importedCount++;
        });

        if(importedCount===0){
          alert('No se encontraron datos v√°lidos en el CSV. Formato: Nombre|Cantidad|Color|Talle|Tela|Temporada|Tipo');
          return;
        }
        localStorage.setItem('inventario', JSON.stringify(inventario));
        actualizarTabla();
        alert(`Se importaron ${importedCount} productos del CSV.`);
      };
      reader.onerror=function(){
        console.error('Error al leer el archivo:', reader.error);
        alert('Error al leer el archivo CSV. Revisa la consola para m√°s detalles.');
      };
      reader.readAsText(file);
    }

    function exportarPDFyCSV(){
      if(inventario.length===0){ alert('El inventario est√° vac√≠o. Agreg√° productos antes de exportar.'); return; }

      // PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation:'landscape' });
      doc.setFontSize(18);
      doc.text('Inventario de Ropa', 10, 20);
      const tableData = inventario.map(p=>[p.nombre,p.cantidad,p.color,p.talle,p.tela,p.temporada,p.tipo]);
      doc.autoTable({
        head: [['Nombre','Cantidad','Color','Talle','Tela','Temporada','Tipo']],
        body: tableData,
        startY: 30,
        theme: 'striped',
        styles: { fontSize: 12, cellPadding: 5 },
        headStyles: { fillColor: [52,152,219], textColor: [255,255,255], fontSize: 14 }
      });
      doc.save('inventario.pdf');

      // CSV
      let csv='Nombre|Cantidad|Color|Talle|Tela|Temporada|Tipo\n';
      inventario.forEach(p=>{
        csv+=`${p.nombre}|${p.cantidad}|${p.color}|${p.talle}|${p.tela}|${p.temporada}|${p.tipo}\n`;
      });
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const link=document.createElement('a');
      if(link.download!==undefined){
        const url=URL.createObjectURL(blob);
        link.setAttribute('href',url);
        link.setAttribute('download','inventario.csv');
        link.style.visibility='hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    }

    function limpiarFormulario(){
      document.getElementById('nombre').value='';
      document.getElementById('cantidad').value='';
      document.getElementById('color').value='';
      document.getElementById('talle').value='';
      document.getElementById('tela').selectedIndex=0;
      temporadaSeleccionada=''; tipoSeleccionado='';
      document.querySelectorAll('.option-btn').forEach(btn=>btn.classList.remove('selected'));
    }

    actualizarTabla();
  </script>
</body>
</html>
